{% extends "base.html" %}

{% block content %}
<div class="container mt-4" style="max-width: 900px;">

    <!-- Header -->
    <div class="mb-3">
        <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary btn-sm">‚Üê Back</a>
    </div>

    <h3 class="text-center mb-1">Edit Product</h3>
    <p class="text-center text-muted">
        Updating: <strong>{{ product.name }}</strong>
    </p>

    <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}

        <div class="row">

            <!-- LEFT: Product Details -->
            <div class="col-md-7">

                <!-- Product Name -->
                <div class="mb-3">
                    {{ form.name.label(class="form-label") }}
                    {{ form.name(class="form-control") }}
                </div>

                <!-- Description -->
                <div class="mb-3">
                    {{ form.description.label(class="form-label") }}
                    {{ form.description(class="form-control", rows="4") }}
                </div>

                <!-- Price -->
                <div class="mb-3">
                    {{ form.price.label(class="form-label") }}
                    {{ form.price(class="form-control") }}
                </div>

                <!-- Stock Quantity -->
                <div class="mb-3">
                    {{ form.stock_quantity.label(class="form-label") }}
                    {{ form.stock_quantity(class="form-control") }}
                </div>

                <!-- Size / Unit -->
                <div class="mb-3">
                    {{ form.size_unit.label(class="form-label") }}
                    {{ form.size_unit(class="form-control") }}
                </div>

                <!-- Category -->
                <div class="mb-3">
                    {{ form.category_id.label(class="form-label") }}
                    {{ form.category_id(class="form-select") }}
                </div>

            </div>

            <!-- RIGHT: Images -->
            <h4 class="mt-4 mb-3 text-center">Product Images</h4>

            <div class="d-flex gap-3 flex-wrap justify-content-center mb-3">

                {% for field in product_image_fields %}
                    {% set img = existing_images[loop.index0] if existing_images|length > loop.index0 else None %}

                    <label for="{{ field.id }}" class="gallery-slot cursor-pointer text-center">

                        <div class="border rounded d-flex align-items-center justify-content-center"
                            style="width:120px; height:120px; overflow:hidden;">

                            {% if img %}
                                <!-- Cloudinary-ready image -->
                                <img src="{{ img.image_url }}"
                                     style="width:100%; height:100%; object-fit:cover;">
                            {% else %}
                                <i class="fas fa-image fa-3x text-secondary"></i>
                            {% endif %}

                        </div>

                        {{ field(id=field.id, style="display:none;") }}
                    </label>
                {% endfor %}

            </div>

        </div>

        <!-- Actions -->
        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary px-4">
                Save Changes
            </button>
            <a href="{{ url_for('main.seller_dashboard') }}" class="btn btn-outline-secondary ms-2">
                Cancel
            </a>
        </div>

    </form>

</div>
{% endblock %}
